pipeline {
    agent any
    parameters {
        choice(name: 'ACTION', choices: ['apply', 'destroy'], description: 'ðŸ”§ Action Terraform')
    }
    stages {
        stage('Checkout') {
            steps {
                deleteDir()
                checkout scm
                
                script {
                    writeFile file: 'ecr-terraform/backend.tf', text: """
terraform {
  backend "local" {}
}
"""
                }
            }
        }
        stage('Terraform Run') {
            steps {
                dir('ecr-terraform') {
                    sh 'terraform init -reconfigure'
                    sh "terraform ${params.ACTION} -auto-approve"
                }
            }
        }
    }
}
